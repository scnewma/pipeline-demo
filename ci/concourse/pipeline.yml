resources:
- name: repo
  type: git
  source:
    uri: ((repo-url))
    branch: master
    private_key: ((private-key))

- name: version
  type: git
  source:
    uri: ((repo-url))
    branch: version
    private_key: ((private-key))

jobs:
- name: generate-version
  public: true
  plan:
  - aggregate:
    - get: repo
    - get: version
  - task: generate-version
    file: repo/ci/concourse/tasks/generate-version/task.yml
    params:
      GIT_EMAIL: ((git-email))
      GIT_NAME: ((git-name))
  - put: version
    params:
      repository: updated-version


#- name: build-and-upload
#  serial: true
#  public: false
#  plan:
#  - aggregate:
#    - get: repo
#    - get: version
#      resource: version
#      passed:
#      - generate-version
#      trigger: true
#  - task: build-and-upload
#    file: repo/ci/concourse/tasks/build-and-upload/task.yml
#    params:
#      <<: *common-params
#  - put: repo
#    params:
#      repository: out
#      tag: out/tag
#      only_tag: true
